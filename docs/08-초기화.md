# 8. ì´ˆê¸°í™” (Initialization)

## ëª©ì°¨
1. [ê°œìš”](#ê°œìš”)
2. [Entry Point - index.ts](#entry-point---indexts)
3. [ì´ˆê¸°í™” ì‹œí€€ìŠ¤ (16ë‹¨ê³„)](#ì´ˆê¸°í™”-ì‹œí€€ìŠ¤-16ë‹¨ê³„)
4. [ëª…ë ¹ì¤„ ì‚¬ìš©ë²•](#ëª…ë ¹ì¤„-ì‚¬ìš©ë²•)
5. [ì˜ì¡´ì„± ì´ˆê¸°í™” ìˆœì„œ](#ì˜ì¡´ì„±-ì´ˆê¸°í™”-ìˆœì„œ)
6. [ì—ëŸ¬ ì²˜ë¦¬](#ì—ëŸ¬-ì²˜ë¦¬)

---

## ê°œìš”

GAIì˜ ì´ˆê¸°í™” í”„ë¡œì„¸ìŠ¤ëŠ” **16ë‹¨ê³„**ë¡œ êµ¬ì„±ë˜ì–´ ìˆìœ¼ë©°, ê¶Œí•œ í™•ì¸ë¶€í„° Agent ì‹¤í–‰ê¹Œì§€ ì²´ê³„ì ìœ¼ë¡œ ì§„í–‰ë©ë‹ˆë‹¤.

**Entry Point**: `src/index.ts` (178 lines)

**ì´ˆê¸°í™” ë‹¨ê³„**:
1. ê¶Œí•œ í™•ì¸ (macOS)
2. ì„¤ì • ë¡œë“œ
3. ì„¤ì • ê²€ì¦
4. LLM Manager ì´ˆê¸°í™”
5. Tool Registry ì´ˆê¸°í™”
6. ê¸°ë³¸ ë„êµ¬ ë“±ë¡
7. Vision ë„êµ¬ ë“±ë¡
8. Action ë„êµ¬ ë“±ë¡
9. Navigation Brain ì´ˆê¸°í™”
10. Brain ë„êµ¬ ë“±ë¡
11. ë„êµ¬ ëª©ë¡ ì¶œë ¥
12. Agent ì´ˆê¸°í™”
13. ì„¸ì…˜ ì‹œì‘
14. ì‚¬ìš©ì ì…ë ¥ íŒŒì‹±
15. ìš”ì²­ ì²˜ë¦¬
16. ì •ë¦¬ ë° ì¢…ë£Œ

---

## Entry Point - index.ts

### íŒŒì¼ ìœ„ì¹˜
- `src/index.ts` (178 lines)

### main() í•¨ìˆ˜

```typescript
async function main() {
  console.log('ğŸ¤– GAI (Graphic Agent Interface) - Starting...\n');

  // Step 1-2: Permission Check
  // Step 3-4: Configuration
  // Step 5-11: Component Initialization
  // Step 12-13: Agent Setup
  // Step 14-16: User Request Processing
}

main().catch((error) => {
  console.error('âŒ Fatal error:', error);
  process.exit(1);
});
```

**ì—ëŸ¬ í•¸ë“¤ë§**:
- main() í•¨ìˆ˜ ë‚´ ì—ëŸ¬ëŠ” catchë¡œ ì¡ì•„ì„œ ì¶œë ¥ í›„ ì¢…ë£Œ
- ì •ìƒ ì¢…ë£Œ: exit code 0
- ì—ëŸ¬ ì¢…ë£Œ: exit code 1

---

## ì´ˆê¸°í™” ì‹œí€€ìŠ¤ (16ë‹¨ê³„)

### Step 1-2: Permission Check (macOS Only)

```typescript
// Check permissions on macOS
if (isMacOS()) {
  const permissions = MacPermissions.checkAllPermissions();

  if (!permissions.allGranted) {
    console.log('âš ï¸  GUI automation requires permissions:\n');

    if (permissions.accessibility !== 'authorized') {
      console.log(
        `   Accessibility: ${permissions.accessibility} (required for keyboard/mouse control)`
      );
    }

    if (permissions.screenRecording !== 'authorized') {
      console.log(
        `   Screen Recording: ${permissions.screenRecording} (required for screen capture)`
      );
    }

    console.log(
      '\nğŸ’¡ To grant permissions: System Preferences > Security & Privacy > Privacy\n'
    );

    // Request permissions
    if (permissions.accessibility !== 'authorized') {
      MacPermissions.requestAccessibility();
    }
    if (permissions.screenRecording !== 'authorized') {
      MacPermissions.requestScreenRecording();
    }

    console.log('Please grant permissions and restart the application.\n');
    process.exit(1);
  }

  console.log('âœ… Permissions: Accessibility and Screen Recording granted\n');
}
```

**ë‹¨ê³„**:
1. **í”Œë«í¼ í™•ì¸**: `isMacOS()` - macOSê°€ ì•„ë‹ˆë©´ ìŠ¤í‚µ
2. **ê¶Œí•œ í™•ì¸**: `MacPermissions.checkAllPermissions()`
   - Accessibility: ë§ˆìš°ìŠ¤/í‚¤ë³´ë“œ ì œì–´
   - Screen Recording: í™”ë©´ ìº¡ì²˜
3. **ê¶Œí•œ ë¶€ì¡± ì‹œ**:
   - ì—ëŸ¬ ë©”ì‹œì§€ ì¶œë ¥
   - ê¶Œí•œ ìš”ì²­ (`requestAccessibility()`, `requestScreenRecording()`)
   - System Preferences ì•ˆë‚´
   - **ì•± ì¢…ë£Œ** (exit code 1)
4. **ê¶Œí•œ ì¶©ì¡± ì‹œ**: ê³„ì† ì§„í–‰

**ì¶œë ¥ ì˜ˆì‹œ** (ê¶Œí•œ ë¶€ì¡±):
```
âš ï¸  GUI automation requires permissions:

   Accessibility: denied (required for keyboard/mouse control)
   Screen Recording: not determined (required for screen capture)

ğŸ’¡ To grant permissions: System Preferences > Security & Privacy > Privacy

Please grant permissions and restart the application.
```

**ì¶œë ¥ ì˜ˆì‹œ** (ê¶Œí•œ ì¶©ì¡±):
```
âœ… Permissions: Accessibility and Screen Recording granted
```

---

### Step 3-4: Configuration Loading & Validation

```typescript
// Load configuration
const configLoader = new ConfigLoader();
const config = configLoader.get();

// Validate configuration
const validation = configLoader.validate();
if (!validation.valid) {
  console.error('âŒ Configuration errors:');
  validation.errors.forEach((err) => console.error(`  - ${err}`));
  console.error('\nPlease set ANTHROPIC_API_KEY in .env file or config/config.json');
  process.exit(1);
}
```

**ë‹¨ê³„**:
3. **ì„¤ì • ë¡œë“œ**:
   - `new ConfigLoader()` â†’ 3-tier ë³‘í•© (default, file, env)
   - `configLoader.get()` â†’ ìµœì¢… Config ê°ì²´

4. **ì„¤ì • ê²€ì¦**:
   - `configLoader.validate()` â†’ LLM provider, API key, model í™•ì¸
   - ê²€ì¦ ì‹¤íŒ¨ ì‹œ ì—ëŸ¬ ì¶œë ¥ í›„ ì¢…ë£Œ

**ì¶œë ¥ ì˜ˆì‹œ** (ê²€ì¦ ì‹¤íŒ¨):
```
âŒ Configuration errors:
  - LLM config (default): API key required for anthropic
  - LLM config (vision): model not specified

Please set ANTHROPIC_API_KEY in .env file or config/config.json
```

**ì„¤ì • ì¶œë ¥**:
```typescript
console.log(`âœ… Configuration loaded:`);

// Check if mode config
if ('default' in config.llm && 'fast' in config.llm && 'vision' in config.llm) {
  const modeConfig = config.llm as LLMModeConfig;
  console.log(`   Mode: Multi-mode (default/fast/vision)`);
  console.log(`   Default: ${modeConfig.default.provider} / ${modeConfig.default.model}`);
  console.log(`   Fast: ${modeConfig.fast.provider} / ${modeConfig.fast.model}`);
  console.log(`   Vision: ${modeConfig.vision.provider} / ${modeConfig.vision.model}`);
} else {
  const singleConfig = config.llm as LLMConfig;
  console.log(`   Mode: Single`);
  console.log(`   Provider: ${singleConfig.provider}`);
  console.log(`   Model: ${singleConfig.model}`);
}

console.log(`   Max Iterations: ${config.agent.maxIterations}\n`);
```

**ì¶œë ¥ ì˜ˆì‹œ** (Multi-mode):
```
âœ… Configuration loaded:
   Mode: Multi-mode (default/fast/vision)
   Default: anthropic / claude-sonnet-4-5-20250929
   Fast: anthropic / claude-haiku-4-5-20251001
   Vision: anthropic / claude-opus-4-6
   Max Iterations: 10
```

**ì¶œë ¥ ì˜ˆì‹œ** (Single mode):
```
âœ… Configuration loaded:
   Mode: Single
   Provider: anthropic
   Model: claude-sonnet-4-5-20250929
   Max Iterations: 10
```

---

### Step 5: Initialize LLM Manager

```typescript
// Initialize LLM Manager
const llmManager = new LLMManager(config.llm);
const llm = llmManager.getAdapter();
```

**ë¡œì§**:
- `new LLMManager(config.llm)`:
  - Single mode â†’ 1ê°œ LLM ìƒì„±
  - Multi-mode â†’ 3ê°œ LLM ìƒì„± (default, fast, vision)
- `getAdapter()`:
  - Default LLMì˜ adapter ë°˜í™˜
  - ScreenReaderTool ë“±ì—ì„œ ì‚¬ìš©

**ë‚´ë¶€ ë™ì‘** (LLMManager ìƒì„±ì):
```typescript
constructor(config: LLMConfig | LLMModeConfig) {
  if (this.isModeConfig(config)) {
    // Multi-mode
    this.modeEnabled = true;
    this.defaultLLM = this.createLLM(config.default);
    this.fastLLM = this.createLLM(config.fast);
    this.visionLLM = this.createLLM(config.vision);
  } else {
    // Single mode
    this.modeEnabled = false;
    this.defaultLLM = this.createLLM(config);
  }
}

private createLLM(config: LLMConfig): BaseLLM {
  switch (config.provider) {
    case 'anthropic': return new AnthropicLLM(config);
    case 'openai': return new OpenAILLM(config);
    case 'google': return new GoogleLLM(config);
    case 'ollama': return new OllamaLLM(config);
  }
}
```

---

### Step 6: Initialize Tool Registry

```typescript
// Initialize Tool Registry
const toolRegistry = new ToolRegistry();
```

**ë¡œì§**:
- `new ToolRegistry()` â†’ ë¹ˆ Map ìƒì„±
- ë„êµ¬ ë“±ë¡ ì¤€ë¹„

---

### Step 7: Register Basic Tools

```typescript
// Register basic tools
toolRegistry.register(new EchoTool());
toolRegistry.register(new ScreenReaderTool(llm));
```

**ë“±ë¡ ë„êµ¬**:
1. **EchoTool**: í…ŒìŠ¤íŠ¸ìš© ì—ì½” ë„êµ¬
2. **ScreenReaderTool**: Deprecated (SmartScreenReaderToolë¡œ ëŒ€ì²´)

**ì˜ì¡´ì„±**:
- ScreenReaderToolì€ `llm` (BaseLLM) í•„ìš”

---

### Step 8: Register Vision Tools

```typescript
// Register Vision tools
toolRegistry.register(new SmartScreenReaderTool(llmManager));
toolRegistry.register(new ScreenCaptureTool());
toolRegistry.register(new OCRTool());
```

**ë“±ë¡ ë„êµ¬**:
1. **SmartScreenReaderTool**: LLM ê¸°ë°˜ í™”ë©´ ë¶„ì„ (quick/detailed)
2. **ScreenCaptureTool**: í™”ë©´ ìº¡ì²˜ (base64)
3. **OCRTool**: OCR ìˆ˜í–‰

**ì˜ì¡´ì„±**:
- SmartScreenReaderToolì€ `llmManager` í•„ìš” (vision mode ì‚¬ìš©)

---

### Step 9: Register Action Tools

```typescript
// Register Action tools
toolRegistry.register(new ClickTool());
toolRegistry.register(new TypeTool());
toolRegistry.register(new KeyPressTool());
toolRegistry.register(new TabNavigateTool());
```

**ë“±ë¡ ë„êµ¬**:
1. **ClickTool**: í´ë¦­ (ì¢Œí‘œ/OCR)
2. **TypeTool**: í…ìŠ¤íŠ¸ íƒ€ì´í•‘
3. **KeyPressTool**: í‚¤ ì¡°í•©
4. **TabNavigateTool**: Tab ë„¤ë¹„ê²Œì´ì…˜

**ì˜ì¡´ì„±**: ì—†ìŒ (ìì²´ ë¡œì§)

---

### Step 10: Initialize Navigation Brain

```typescript
// Initialize Navigation Brain
const brainStorage = new JSONStorage();
const brain = new NavigationBrain(brainStorage, llmManager);
await brain.initialize();
console.log('âœ… Navigation Brain initialized\n');
```

**ë‹¨ê³„**:
1. **Storage ìƒì„±**: `new JSONStorage()` - JSON íŒŒì¼ ê¸°ë°˜ ì €ì¥ì†Œ
2. **Brain ìƒì„±**: `new NavigationBrain(storage, llmManager)`
3. **ì´ˆê¸°í™”**: `await brain.initialize()`
   - JSON íŒŒì¼ì—ì„œ ê¸°ì¡´ ê·¸ë˜í”„ ë¡œë“œ
   - Spotlight ë…¸ë“œ ì´ˆê¸°í™”

**brain.initialize() ë‚´ë¶€ ë™ì‘**:
```typescript
async initialize(): Promise<boolean> {
  console.log('[NavigationBrain] Initializing...');

  // 1. Load graph from storage
  const loaded = await this.storage.load();
  if (loaded) {
    this.graph = loaded;
    console.log(`[NavigationBrain] Loaded ${this.getAllNodes().length} nodes from storage`);
  } else {
    console.log('[NavigationBrain] No existing graph found, starting fresh');
  }

  // 2. Initialize Spotlight node
  await this.initializeSpotlightNode();

  console.log('[NavigationBrain] Initialization complete');
  return true;
}
```

**Spotlight ë…¸ë“œ ì´ˆê¸°í™”**:
```typescript
private async initializeSpotlightNode(): Promise<void> {
  const spotlightNodeId: NodeId = {
    programName: 'Spotlight',
    stateHash: 'system-spotlight',
  };

  // ì´ë¯¸ ì¡´ì¬í•˜ë©´ ìŠ¤í‚µ
  if (this.graph.nodes.has(nodeIdToKey(spotlightNodeId))) {
    console.log('[NavigationBrain] Spotlight node already exists');
    return;
  }

  // Spotlight ë…¸ë“œ ì¶”ê°€
  this.addNode(spotlightNodeId, {
    title: 'Spotlight Search',
    description: 'macOS Spotlight - system-level launcher',
    createdAt: new Date(),
    lastVisitedAt: new Date(),
    visitCount: 0,
  });

  console.log('[NavigationBrain] Initialized Spotlight node');
}
```

**ì¶œë ¥ ì˜ˆì‹œ**:
```
[NavigationBrain] Initializing...
[NavigationBrain] Loaded 12 nodes from storage
[NavigationBrain] Spotlight node already exists
[NavigationBrain] Initialization complete
âœ… Navigation Brain initialized
```

---

### Step 11: Register Brain Tools

```typescript
// Register Brain tools
toolRegistry.register(new NavigateToTool(brain));
toolRegistry.register(new GetCurrentNodeTool(brain));
toolRegistry.register(new LaunchAppTool());
```

**ë“±ë¡ ë„êµ¬**:
1. **NavigateToTool**: brain.navigateTo() í˜¸ì¶œ
2. **GetCurrentNodeTool**: brain.identifyCurrentNode() + ê²½ë¡œ ì •ë³´
3. **LaunchAppTool**: Spotlightë¡œ ì•± ì‹¤í–‰

**ì˜ì¡´ì„±**:
- NavigateToTool, GetCurrentNodeToolì€ `brain` í•„ìš”

**ì´ ë“±ë¡ ë„êµ¬**: 12ê°œ
- Basic: 2ê°œ (Echo, ScreenReader)
- Vision: 3ê°œ (SmartScreenReader, ScreenCapture, OCR)
- Action: 4ê°œ (Click, Type, KeyPress, TabNavigate)
- Brain: 3ê°œ (NavigateTo, GetCurrentNode, LaunchApp)

---

### Step 12: Display Registered Tools

```typescript
console.log(`âœ… Registered ${toolRegistry.count()} tools:`);
toolRegistry.getAll().forEach((tool) => {
  console.log(`   - ${tool.name}: ${tool.description}`);
});
console.log('');
```

**ì¶œë ¥ ì˜ˆì‹œ**:
```
âœ… Registered 12 tools:
   - echo: Echoes back the input message. Useful for testing.
   - get_current_screen: Captures and analyzes the current screen state...
   - smart_screen_reader: Captures and analyzes screen using appropriate LLM mode...
   - capture_screen: Capture a screenshot of the entire screen or a specific region...
   - ocr: Perform OCR (text recognition) on an image file or the current screen...
   - click: Click at specific coordinates or search for text on screen and click it...
   - type_text: Type text into the currently focused input field...
   - press_key: Press keyboard keys with optional modifiers...
   - tab_navigate: Navigate through UI elements using Tab key...
   - navigate_to: Navigate to a specific screen or state...
   - get_current_node: Get information about the current screen state...
   - launch_app: Launch an application via Spotlight...
```

---

### Step 13: Initialize Agent

```typescript
// Initialize Agent
const agent = new Agent(llmManager, toolRegistry, {
  maxIterations: config.agent.maxIterations,
  verbose: true,
});
```

**íŒŒë¼ë¯¸í„°**:
- `llmManager`: LLM Manager ì¸ìŠ¤í„´ìŠ¤
- `toolRegistry`: Tool Registry ì¸ìŠ¤í„´ìŠ¤
- `config`:
  - `maxIterations`: ìµœëŒ€ ë°˜ë³µ íšŸìˆ˜ (ê¸°ë³¸ 10)
  - `verbose`: ìƒì„¸ ë¡œê·¸ ì¶œë ¥ ì—¬ë¶€ (true)

**Agent ìƒì„±ì**:
```typescript
constructor(
  private llmManager: LLMManager,
  private toolRegistry: ToolRegistry,
  config: AgentConfig = {}
) {
  this.maxIterations = config.maxIterations || 10;
  this.verbose = config.verbose ?? false;
}
```

---

### Step 14: Start Session

```typescript
// Start session
agent.startSession();
```

**ë‚´ë¶€ ë™ì‘**:
```typescript
startSession(): void {
  this.llmManager.clearHistory();
}
```

**ëª©ì **: ì´ì „ ì„¸ì…˜ì˜ íˆìŠ¤í† ë¦¬ ì´ˆê¸°í™”

---

### Step 15: Parse User Input

```typescript
// Get user input from command line
const userInput = process.argv.slice(2).join(' ');

if (!userInput) {
  console.log('Usage: npm start <your message>');
  console.log('Example: npm start "Echo hello world"');
  console.log('Example: npm start "Analyze the current screen"');
  process.exit(0);
}

console.log(`ğŸ“ User: ${userInput}\n`);
console.log('ğŸ¤” Agent thinking...\n');
console.log('â”'.repeat(60));
```

**ë¡œì§**:
1. **ëª…ë ¹ì¤„ ì¸ì íŒŒì‹±**: `process.argv.slice(2)` - ì²« 2ê°œ ì œì™¸ (`node`, `index.js`)
2. **ê³µë°±ìœ¼ë¡œ ê²°í•©**: `join(' ')` - ì—¬ëŸ¬ ë‹¨ì–´ë¥¼ í•˜ë‚˜ì˜ ë¬¸ìì—´ë¡œ
3. **ì…ë ¥ ì—†ìœ¼ë©´**: Usage ì¶œë ¥ í›„ ì¢…ë£Œ (exit code 0)
4. **ì…ë ¥ ìˆìœ¼ë©´**: User ì…ë ¥ ì¶œë ¥

**process.argv ì˜ˆì‹œ**:
```bash
npm start "Navigate to Chrome"
```
â†’ `process.argv = ['node', '/path/to/index.js', 'Navigate', 'to', 'Chrome']`
â†’ `userInput = 'Navigate to Chrome'`

**ì¶œë ¥ ì˜ˆì‹œ**:
```
ğŸ“ User: Navigate to Chrome

ğŸ¤” Agent thinking...

â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
```

---

### Step 16: Process Request

```typescript
// Process request
const response = await agent.processRequest(userInput);

console.log('â”'.repeat(60));
console.log(`\nâœ¨ Final Response:\n`);
console.log(response.message);

if (response.finished) {
  console.log('\nâœ… Task completed!');
} else {
  console.log('\nâš ï¸  Task incomplete (max iterations reached)');
}

// Clean up
agent.endSession();
```

**ë‹¨ê³„**:
1. **ìš”ì²­ ì²˜ë¦¬**: `agent.processRequest(userInput)`
   - Agentic loop ì‹¤í–‰ (ìµœëŒ€ 10íšŒ ë°˜ë³µ)
   - LLM í˜¸ì¶œ â†’ Tool ì‹¤í–‰ â†’ LLM í˜¸ì¶œ â†’ ...
   - ì¢…ë£Œ ì¡°ê±´: Tool call ì—†ìŒ ë˜ëŠ” max iterations

2. **ì‘ë‹µ ì¶œë ¥**:
   - Final response message
   - ì™„ë£Œ ì—¬ë¶€ (finished or incomplete)

3. **ì •ë¦¬**: `agent.endSession()` - íˆìŠ¤í† ë¦¬ ì´ˆê¸°í™”

**agent.processRequest() ë‚´ë¶€ ë™ì‘** (ìš”ì•½):
```typescript
async processRequest(input: string): Promise<AgentResponse> {
  this.llmManager.addUserMessage(input);

  let iterations = 0;
  while (iterations < this.maxIterations) {
    iterations++;

    // LLM í˜¸ì¶œ
    const response = await this.llmManager.send(tools);

    // Tool call ì—†ìœ¼ë©´ ì¢…ë£Œ
    if (!response.toolCalls || response.toolCalls.length === 0) {
      return { message: response.content, finished: true };
    }

    // Tool ì‹¤í–‰
    const toolResults = await this.executeToolCalls(response.toolCalls);

    // Tool ê²°ê³¼ë¥¼ íˆìŠ¤í† ë¦¬ì— ì¶”ê°€
    for (let i = 0; i < toolCalls.length; i++) {
      this.llmManager.addToolResult(toolCalls[i].id, toolResults[i].data || toolResults[i].error);
    }
  }

  // Max iterations ë„ë‹¬
  return { message: '...', finished: false };
}
```

**ì¶œë ¥ ì˜ˆì‹œ** (verbose=true):
```
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

[Iteration 1/10]
LLM Response: I'll help you navigate to Chrome...
Stop Reason: tool_use
Tool Calls: 1

Executing 1 tool calls...
  - launch_app({"appName":"Google Chrome"}...)
    â†’ Success

[Iteration 2/10]
LLM Response: I've successfully launched Google Chrome...
Stop Reason: end_turn
Tool Calls: 0

â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

âœ¨ Final Response:

I've successfully launched Google Chrome using Spotlight. The application should now be running on your screen.

âœ… Task completed!
```

---

## ëª…ë ¹ì¤„ ì‚¬ìš©ë²•

### ê¸°ë³¸ ì‚¬ìš©ë²•

```bash
npm start "<your message>"
```

### ì˜ˆì‹œ

#### 1. Echo í…ŒìŠ¤íŠ¸
```bash
npm start "Echo hello world"
```

**ì¶œë ¥**:
```
ğŸ“ User: Echo hello world

[Iteration 1/10]
...
  - echo({"message":"hello world"})
    â†’ Success

âœ¨ Final Response:
hello world

âœ… Task completed!
```

#### 2. í™”ë©´ ë¶„ì„
```bash
npm start "Analyze the current screen"
```

**ì¶œë ¥**:
```
ğŸ“ User: Analyze the current screen

[Iteration 1/10]
...
  - smart_screen_reader({"mode":"detailed"})
    â†’ Success

âœ¨ Final Response:
The current screen shows a macOS desktop with Finder open...

âœ… Task completed!
```

#### 3. ë„¤ë¹„ê²Œì´ì…˜
```bash
npm start "Navigate to System Preferences"
```

**ì¶œë ¥**:
```
ğŸ“ User: Navigate to System Preferences

[Iteration 1/10]
...
  - navigate_to({"target":"System Preferences"})
    â†’ Success

âœ¨ Final Response:
I've successfully navigated to System Preferences...

âœ… Task completed!
```

#### 4. ë³µì¡í•œ ì‘ì—…
```bash
npm start "Open Terminal and create a new file called test.txt"
```

**ì¶œë ¥**:
```
ğŸ“ User: Open Terminal and create a new file called test.txt

[Iteration 1/10]
...
  - launch_app({"appName":"Terminal"})
    â†’ Success

[Iteration 2/10]
...
  - type_text({"text":"touch test.txt","pressEnter":true})
    â†’ Success

âœ¨ Final Response:
I've opened Terminal and created a new file called test.txt...

âœ… Task completed!
```

### ì¸ì ì—†ì´ ì‹¤í–‰ ì‹œ

```bash
npm start
```

**ì¶œë ¥**:
```
Usage: npm start <your message>
Example: npm start "Echo hello world"
Example: npm start "Analyze the current screen"
```

---

## ì˜ì¡´ì„± ì´ˆê¸°í™” ìˆœì„œ

### ì˜ì¡´ì„± ê·¸ë˜í”„

```
ConfigLoader
  â†“
Config
  â†“
LLMManager
  â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚             â”‚              â”‚
llm (BaseLLM) â”‚              â”‚
â”‚             â”‚              â”‚
â”‚         ToolRegistry   JSONStorage
â”‚             â”‚              â”‚
â”‚         (9 tools)          â”‚
â”‚             â”‚              â”‚
â”‚             â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜
â”‚                    â”‚
â”‚            NavigationBrain
â”‚                    â”‚
â”‚               (3 tools)
â”‚                    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
                     â”‚
                   Agent
                     â”‚
               User Request
```

**ì˜ì¡´ì„± ì„¤ëª…**:
1. **ConfigLoader** â†’ Config ê°ì²´ ìƒì„±
2. **Config** â†’ LLMManager ì´ˆê¸°í™”
3. **LLMManager** â†’ 3ê°€ì§€ë¡œ ë¶„ê¸°:
   - `llm` (BaseLLM): ScreenReaderToolì— ì£¼ì…
   - `llmManager`: SmartScreenReaderTool, NavigationBrainì— ì£¼ì…
   - `toolRegistry`: Agentì— ì£¼ì…
4. **JSONStorage** + **LLMManager** â†’ NavigationBrain ì´ˆê¸°í™”
5. **NavigationBrain** â†’ Brain Tools (3ê°œ) ë“±ë¡
6. **ToolRegistry** + **LLMManager** â†’ Agent ì´ˆê¸°í™”

### ì´ˆê¸°í™” ìˆœì„œ (ì‹œê°„ìˆœ)

| ìˆœì„œ | ì»´í¬ë„ŒíŠ¸ | ì˜ì¡´ì„± |
|------|----------|--------|
| 1 | MacPermissions (macOS) | ì—†ìŒ |
| 2 | ConfigLoader | ì—†ìŒ |
| 3 | Config | ConfigLoader |
| 4 | LLMManager | Config |
| 5 | ToolRegistry | ì—†ìŒ |
| 6 | Basic Tools (2) | llm (ScreenReaderTool) |
| 7 | Vision Tools (3) | llmManager (SmartScreenReader) |
| 8 | Action Tools (4) | ì—†ìŒ |
| 9 | JSONStorage | ì—†ìŒ |
| 10 | NavigationBrain | JSONStorage, llmManager |
| 11 | Brain Tools (3) | brain (NavigateTo, GetCurrentNode) |
| 12 | Agent | llmManager, toolRegistry |

**ìˆœì„œê°€ ì¤‘ìš”í•œ ì´ìœ **:
- Brain ToolsëŠ” NavigationBrainì´ ì´ˆê¸°í™”ëœ í›„ ë“±ë¡ ê°€ëŠ¥
- AgentëŠ” ëª¨ë“  ë„êµ¬ê°€ ë“±ë¡ëœ í›„ ìƒì„± ê°€ëŠ¥
- LLMManagerëŠ” Configê°€ ë¡œë“œëœ í›„ ìƒì„± ê°€ëŠ¥

---

## ì—ëŸ¬ ì²˜ë¦¬

### 1. Permission Denied (macOS)

**ì—ëŸ¬**:
```
âš ï¸  GUI automation requires permissions:

   Accessibility: denied (required for keyboard/mouse control)

Please grant permissions and restart the application.
```

**í•´ê²°**:
1. System Preferences â†’ Security & Privacy â†’ Privacy
2. Accessibility ì²´í¬
3. ì•± ì¬ì‹¤í–‰

**Exit Code**: 1

---

### 2. Configuration Error

**ì—ëŸ¬**:
```
âŒ Configuration errors:
  - LLM config (default): API key required for anthropic

Please set ANTHROPIC_API_KEY in .env file or config/config.json
```

**í•´ê²°**:
1. `.env` íŒŒì¼ ìƒì„±
2. `ANTHROPIC_API_KEY=sk-ant-...` ì¶”ê°€
3. ì•± ì¬ì‹¤í–‰

**Exit Code**: 1

---

### 3. No User Input

**ì—ëŸ¬**:
```
Usage: npm start <your message>
Example: npm start "Echo hello world"
```

**í•´ê²°**:
```bash
npm start "your message here"
```

**Exit Code**: 0 (ì •ìƒ ì¢…ë£Œ)

---

### 4. Fatal Error (Runtime)

**ì—ëŸ¬**:
```
âŒ Fatal error: Error: ...
```

**ì›ì¸**:
- LLM API í˜¸ì¶œ ì‹¤íŒ¨
- Tool ì‹¤í–‰ ì—ëŸ¬
- ë„¤íŠ¸ì›Œí¬ ì—ëŸ¬

**Exit Code**: 1

---

## ì „ì²´ ì´ˆê¸°í™” ë¡œê·¸ ì˜ˆì‹œ

```
ğŸ¤– GAI (Graphic Agent Interface) - Starting...

âœ… Permissions: Accessibility and Screen Recording granted

âœ… Configuration loaded:
   Mode: Multi-mode (default/fast/vision)
   Default: anthropic / claude-sonnet-4-5-20250929
   Fast: anthropic / claude-haiku-4-5-20251001
   Vision: anthropic / claude-opus-4-6
   Max Iterations: 10

[NavigationBrain] Initializing...
[NavigationBrain] Loaded 12 nodes from storage
[NavigationBrain] Spotlight node already exists
[NavigationBrain] Initialization complete
âœ… Navigation Brain initialized

âœ… Registered 12 tools:
   - echo: Echoes back the input message. Useful for testing.
   - get_current_screen: Captures and analyzes the current screen state...
   - smart_screen_reader: Captures and analyzes screen using appropriate LLM mode...
   - capture_screen: Capture a screenshot of the entire screen or a specific region...
   - ocr: Perform OCR (text recognition) on an image file or the current screen...
   - click: Click at specific coordinates or search for text on screen and click it...
   - type_text: Type text into the currently focused input field...
   - press_key: Press keyboard keys with optional modifiers...
   - tab_navigate: Navigate through UI elements using Tab key...
   - navigate_to: Navigate to a specific screen or state...
   - get_current_node: Get information about the current screen state...
   - launch_app: Launch an application via Spotlight...

ğŸ“ User: Navigate to Chrome

ğŸ¤” Agent thinking...

â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

[Iteration 1/10]
LLM Response: I'll help you navigate to Chrome...
Stop Reason: tool_use
Tool Calls: 1

Executing 1 tool calls...
  - launch_app({"appName":"Google Chrome"}...)
    â†’ Success

[Iteration 2/10]
LLM Response: I've successfully launched Google Chrome...
Stop Reason: end_turn
Tool Calls: 0

â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

âœ¨ Final Response:

I've successfully launched Google Chrome using Spotlight.

âœ… Task completed!
```

---

## ì •ë¦¬

### ì´ˆê¸°í™” ë‹¨ê³„ ìš”ì•½

| ë‹¨ê³„ | ì»´í¬ë„ŒíŠ¸ | ì‹œê°„ | ì¤‘ìš”ë„ |
|------|----------|------|--------|
| 1-2 | Permission Check | ì¦‰ì‹œ | ğŸ”´ í•„ìˆ˜ (macOS) |
| 3-4 | Configuration | < 100ms | ğŸ”´ í•„ìˆ˜ |
| 5 | LLM Manager | < 100ms | ğŸ”´ í•„ìˆ˜ |
| 6-9 | Tool Registration | < 100ms | ğŸ”´ í•„ìˆ˜ |
| 10 | Navigation Brain | < 500ms | ğŸŸ¡ ì„ íƒ |
| 11 | Brain Tools | ì¦‰ì‹œ | ğŸŸ¡ ì„ íƒ |
| 12-14 | Agent Setup | < 100ms | ğŸ”´ í•„ìˆ˜ |
| 15-16 | User Request | ë³€ë™ | ğŸ”´ í•„ìˆ˜ |

**ì´ ì´ˆê¸°í™” ì‹œê°„**: ì•½ 1ì´ˆ (Brain í¬í•¨)

### í•µì‹¬ ì²´í¬í¬ì¸íŠ¸

âœ… **Permission Check** (macOS):
- Accessibility + Screen Recording
- ë¶€ì¡± ì‹œ ì•± ì¢…ë£Œ

âœ… **Configuration Validation**:
- Provider, Model, API Key í™•ì¸
- ê²€ì¦ ì‹¤íŒ¨ ì‹œ ì•± ì¢…ë£Œ

âœ… **Component Initialization**:
- LLMManager â†’ ToolRegistry â†’ NavigationBrain â†’ Agent
- ì˜ì¡´ì„± ìˆœì„œ ì¤€ìˆ˜

âœ… **Tool Registration**:
- ì´ 12ê°œ ë„êµ¬
- Basic (2) + Vision (3) + Action (4) + Brain (3)

âœ… **User Request Processing**:
- Agentic loop (ìµœëŒ€ 10íšŒ)
- Tool ì‹¤í–‰ + LLM ì‘ë‹µ
- ì„±ê³µ/ì‹¤íŒ¨ ì¶œë ¥

### íŒŒì¼ í¬ê¸°

- `index.ts`: 178 lines
- `Agent.ts`: 156 lines (ì´ì „ì— ì½ìŒ)

**ì´ Entry Point ì½”ë“œ**: 334 lines
